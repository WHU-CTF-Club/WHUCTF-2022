# CTF - Reverse入门简介
> secsome - 2022/10/02

## 前言
**Reverse**作为**CTF**竞赛中的一个必备模块，主要考察选手对于软件的结构，流程，算法，代码等进行逆向拆解和分析。通常在比赛中的**Reverse**模块难度都很具有区分度，因此如果能在这个方向专精通常可以为队伍带来大量的得分收入。

大家现在应该都开了C语言的课程，不知道大家有没有写过这样的代码：
```c
#include <stdio.h>

int main()
{
	char input[100];
	scanf("%s", input);
	
	// ...

	return 0;
}
```

有的同学可能是拿`Visual Studio`来开发的这个程序，然后`MSVC`编译器就会提示你说`scanf`这个函数不安全，大家一般的解决方案就是定义一个宏或者关闭`SDL检查`来绕过这个检查。实际上这就是一个最简单的栈缓冲区漏洞， 在实际的程序中出现这样的问题将会是非常严重的。攻击者可以通过特定的输入轻松的劫持你的程序控制流，当然这一部分不应该放在**Reverse**部分来讲，毕竟这样的二进制漏洞属于**PWN**领域，这里仅作抛砖引玉只用。

**CTF**竞赛中用到的知识与我们安全专业关联性很强，大家在进行比赛的过程中同时也能巩固自己学到甚至是课堂上不会教到的知识，参与一下一定是不会有什么坏处的。~~**说不定你一不小心就拿了一个奖呢）**~~

## 要求
- 熟悉操作系统、汇编语言、加解密等相关知识
- 具有多种高级语言的编程经验
- 熟悉多种编译器的编译原理
- 较强的程序理解与逆向分析能力
- **有耐心，有想法，肯尝试，肯变通**

> 逆向这个东西，四成是经验，两成是实力。还有四成，两成给大胆的猜想，两成给合理的尝试。 - secsome， 跟同学吹水的时候

## 常规流程
1. 使用静态分析工具收集信息
2. 研究程序的保护方法
3. 反汇编程序，定位关键代码
4. 结合动态调试验证自己的猜想
5. 针对程序写出求解代码得到flag

## 常用工具
- 静态分析
  - **IDA Pro**
  - **dnSpy**
  - **Java Decompiler**
  - **dnSpy / ILSpy**
  - binary ninja(IDA 替代)
  - ghidra(IDA替代)
  - binwalk
  - strings
  - file
- 动态调试
  - **gdb (Linux)**
  - **Wingdb (Windows)**
  - **Ollydbg (Windows)**
  - **x64dbg (Windows)**

## 常规逆向题目的Tips (摘自CTF-Wiki)
1. 编码风格
每个程序员的编码风格都有所不同，熟悉开发设计模式的同学能更迅速地分析出函数模块功能。
2. 集中原则
程序员开发程序时，往往习惯将功能相关的代码或是数据写在同一个地方，而在反汇编代码中也能显示出这一情况，因此在分析时可以查看关键代码附近的函数和数据。
3. 代码复用
代码复用情况非常普遍，而最大的源代码仓库**Github**则是最主要的来源。在分析时可以找一些特征（如字符串，代码风格等）在**Github**搜索，可能会发现类似的代码，并据此恢复出分析时缺失的符号信息等。
4. 七分逆向三分猜
合理的猜测往往能事半功倍，遇到可疑函数却看不清里面的逻辑，不妨根据其中的蛛丝马迹猜测其功能，并依据猜测继续向下分析，在不断的猜测验证中，或许能帮助你更加接近代码的真相。
5. 区分代码
拿到反汇编代码，必须能区分哪些代码是人为编写的，而哪些是编译器自动附加的代码。人为编写的代码中，又有哪些是库函数代码，哪些才是出题人自己写的代码，出题人的代码又经过编译器怎样的优化？我们无须花费时间在出题人以外的代码上，这很重要。如果当你分析半天还在库函数里乱转，那不仅体验极差，也没有丝毫效果。
6. 耐心
无论如何，给予足够的时间，总是能将一个程序分析地透彻。但是也不应该过早地放弃分析。相信自己肯定能在抽茧剥丝的过程中突破问题。

## 学习资源推荐
- [题库](https://buuoj.cn/)
- [Wiki](https://ctf-wiki.org/reverse/introduction/)
- **[Google](https://www.google.com/)**
多写题，多看看别的师傅是怎么做题的，多看Writeup，多积累经验，收集用得到的工具，这样你自然就能够不断进步。

## 写在最后
逆向是一个比较容易上手的方向，大家在做题的过程中能够较快的提升自己，获得成就感。同时在学习逆向的过程中，你也会接触到许多与汇编相关的知识，在熟悉它的过程中也能够让你乱鲨下学期的8086汇编语言课。

逆向能力的提升最主要的还是积累经验，这同时包括了工具使用方法的积累与算法特征的识别。只有多练习才有可能取得进步。这次比赛的**Reverse**题目主要是由我来出的，在前面几天的个人赛中的题目大多都将是较为简单的引导型题目，最后两天的团队赛**Reverse**部分的难度也不会太高，希望大家能够积极参与到这个比赛之中。

我个人也是第一次进行出题，不出意外的话在明年四月的校赛上还能跟大家再次见面，大家在做题过程中发现题目存在问题也欢迎积极向我反映，我也会积极解决，并提升自己的出题能力！

这次比赛的开展同时也是我们的一个尝试，即让`CTF`竞赛普及化，我们的计划是今后的每年都要进行这样的以赛代教的活动，大家的积极参与也能使我们积累更多的经验，让之后的活动越办越好！

还记得我在**要求**中最后一栏写到的吗？做逆向这个模块，最重要的就是**有耐心，有想法，肯尝试，肯变通**。大家在自己练习的过程中可以自己慢慢体会。祝大家都能在这次比赛中玩的开心，收获成绩！

## 另外
我会对BUUOJ上第一面的RE题目每道题都给出一个WriteUp，想在RE方向深入学习的同学可以看一下这些WP！

## 补充Android逆向
可参考网站https://ctf-wiki.org/android/basic_develop/basic_develop/

常用工具
- jeb
- apkide少月版
- dex2jar
- resource hacker
- jadx
- apktool
- 多版本java环境和jdk，Android Studio
