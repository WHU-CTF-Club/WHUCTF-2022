; REpsych
; domas, @xoreaxeaxeax

; This file serves as the program effect.  A more sophisticated approach would
; modify the CFG of existing code; for now, we generate new code to create the
; CFG, and simply connect it to existing code (this).

extern printf
extern scanf
extern strlen

code:
push ebp
mov  ebp, esp

sub  esp, 0x100 ; alloc on stack

push message
call printf
add  esp, 4

push pusheen
call printf
add  esp, 4

push input_message
call printf
add  esp, 4

push esp
push input_format
call scanf
add  esp, 8

push esp
call strlen
add  esp, 4

; MAYCTF{secsome_S3creT_C0nTroL_Flow_GraPh}
cmp  eax, 41
jne  incorrect

xor  edx, edx
xor  edi, edi
loop_p:
mov  eax, [esp+edi]
xor	 edx, eax
inc  edi
cmp  edi, 37
jne  loop_p
cmp  edx, 0x4d7c6d41
je	 correct

add  esp, 0x100 ; free stack

incorrect:
push incorrect_length_message
call printf
add  esp, 4
leave
ret

correct:
push correct_length_message
call printf
add  esp, 4
leave
ret

input_message:
db ":", 0x00

input_format:
db "%s", 0x00

correct_length_message:
db "You are right! maybe.", 0x0A, 0x00

incorrect_length_message:
db "You are absolutely wrong!", 0x0A, 0x00

message:
db "Where is my secret flag?", 0x0A, 0x00

pusheen:
db 0x20,0x20,0x20,0xe2,0x96,0x90,0xe2,0x96,0x80,0xe2,0x96,0x84,0x20,0x20,0x20,0x20
db 0x20,0x20,0xe2,0x96,0x84,0xe2,0x96,0x80,0xe2,0x96,0x8c,0x20,0x20,0x20,0xe2,0x96
db 0x84,0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2,0x96,0x84
db 0xe2,0x96,0x84,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20
db 0x0a,0x20,0x20,0x20,0xe2,0x96,0x8c,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x80
db 0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2,0x96,0x80,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x90,0xe2,0x96,0x84,0xe2,0x96,0x80,0xe2,0x96
db 0x80,0xe2,0x96,0x92,0xe2,0x96,0x88,0xe2,0x96,0x88,0xe2,0x96,0x92,0xe2,0x96,0x88
db 0xe2,0x96,0x88,0xe2,0x96,0x92,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x84,0x20
db 0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0xe2,0x96,0x90,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x80,0xe2,0x96,0x84
db 0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0xe2,0x96,0x8c,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x84,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x80,0xe2,0x96,0x84,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0xe2,0x96,0x80,0xe2
db 0x96,0x88,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x88,0xe2,0x96,0x8c,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x88,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x90
db 0xe2,0x96,0x88,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x80,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x8c,0x20
db 0x20,0x20,0x20,0x20,0x0a,0xe2,0x96,0x80,0xe2,0x96,0x8c,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x80,0xe2,0x96,0x92
db 0xe2,0x96,0x80,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x90,0x20,0x20,0x20,0xe2,0x96,0x84,0xe2,0x96
db 0x84,0x0a,0xe2,0x96,0x90,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x8c,0xe2,0x96,0x84,0xe2,0x96,0x88,0xe2,0x96
db 0x92,0xe2,0x96,0x88,0x0a,0xe2,0x96,0x90,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x90,0xe2,0x96,0x92,0xe2,0x96
db 0x88,0xe2,0x96,0x80,0x20,0x0a,0xe2,0x96,0x90,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x90,0xe2,0x96,0x80,0x20
db 0x20,0x20,0x0a,0xe2,0x96,0x90,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x8c,0x20,0x20,0x20,0x20,0x0a,0x20,0xe2
db 0x96,0x8c,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x90,0x20
db 0x20,0x20,0x20,0x20,0x0a,0x20,0xe2,0x96,0x90,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x8c,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x20,0xe2,0x96
db 0x8c,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x90,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20
db 0x20,0xe2,0x96,0x90,0xe2,0x96,0x84,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96
db 0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92
db 0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x92,0xe2
db 0x96,0x92,0xe2,0x96,0x92,0xe2,0x96,0x84,0xe2,0x96,0x8c,0x20,0x20,0x20,0x20,0x20
db 0x20,0x0a,0x20,0x20,0x20,0x20,0xe2,0x96,0x80,0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2
db 0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x84,0xe2,0x96
db 0x84,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x80
db 0xe2,0x96,0x80,0xe2,0x96,0x84,0xe2,0x96,0x84,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2
db 0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x80,0xe2,0x96,0x84,0xe2,0x96
db 0x84,0xe2,0x96,0x80,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x0a,0x20,0x0a,0x00
